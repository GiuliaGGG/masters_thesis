unit.names.variable = "ticker",        # readable name
time.variable = "time_numeric",                  # or numeric time index
treatment.identifier = 3,              # treated company ID
controls.identifier = c(1,2), # control company IDs
time.predictors.prior = 2010.25:2023.75,
time.optimize.ssr = 2010.25:2023.75,         # pre-treatment period
time.plot = 2010.25:2025.75                  # full period to plot
)
dataprep(
foo = df_clean,
predictors = c("assets",  "net_margin_pct"),
dependent = "revenue",
unit.variable = "company_id",          # numeric ID column
unit.names.variable = "ticker",        # readable name
time.variable = "time_numeric",                  # or numeric time index
treatment.identifier = 3,              # treated company ID
controls.identifier = c(1,2), # control company IDs
time.predictors.prior = 2010.25:2023.75,
time.optimize.ssr = 2010.25:2023.75,         # pre-treatment period
time.plot = 2010.25:2025.75                  # full period to plot
)
library(skimr)
install.packages('skimr')
library(skimr)
skim(df_clean$revenue)
skim(df_clean)
df_clean %>%
group_by(ticker) %>%
filter(mean(is.na(data)) < 0.3) %>%   # drop companies with >30% missing
View()
df_clean %>%
group_by(ticker) %>%
View()
df_clean %>%
group_by(fy) %>%
filter(mean(is.na(data)) < 0.3) %>%
View()
dataprep(
foo = df_clean,
predictors = c("assets",  "net_margin_pct"),
dependent = "revenue",
unit.variable = "company_id",          # numeric ID column
unit.names.variable = "ticker",        # readable name
time.variable = "time_numeric",                  # or numeric time index
treatment.identifier = 3,              # treated company ID
controls.identifier = c(1,2), # control company IDs
time.predictors.prior = 2010.25:2023.75,
time.optimize.ssr = 2010.25:2023.75,         # pre-treatment period
time.plot = 2010.25:2025.75                  # full period to plot
)
df_clean$revenue %>% range()
df_clean$revenue %>% hist()
###################################################
### chunk number 1:
###################################################
library("Synth")
library(readr)
library('dplyr')
library(skimr)
df <- read_csv("data/merged_dataset_2025-11-01_16-55.csv")
id_cols <- c("boycotted", "ticker", "fp", "end")
# Step 2: preprocessing
df_clean <- df %>%
filter(ticker != "COKE") %>% #make sure there just one target
filter(ticker != "CMG") %>% #    drop for now, must see if script runs when df is balanced
filter(ticker != "WEN") %>% #drop for now, must see if script runs when df is balanced
filter(ticker != "BROS") %>% #drop for now, must see if script runs when df is balanced
filter(fy != "2026") %>%
mutate(company_id = as.numeric(as.factor(ticker))) %>%
group_by(ticker, fy) %>%
# count quarters per company-year
mutate(n_quarters = n_distinct(fp)) %>%
# keep only company-years with at least 3 quarters
filter(n_quarters >= 3) %>%
ungroup() %>%
select(-n_quarters) %>%       # remove helper column
mutate(across(
.cols = -all_of(id_cols),          # all columns except identifiers
.fns  = ~ as.numeric(.))) %>%      # convert to numeric, quietly
ungroup() %>%
mutate(
# Turn fp (Q1, Q2, Q3, Q4) into numeric quarter fraction
quarter_num = case_when(
fp == "Q1" ~ 0.25,
fp == "Q2" ~ 0.50,
fp == "Q3" ~ 0.75,
fp == "Q4" ~ 1.00,
TRUE ~ NA_real_
),
# Combine fiscal year and quarter into one numeric time variable
time_numeric = fy + quarter_num) %>%
as.data.frame()
###################################################
### chunk number 2:
###################################################
df_clean[85:89, 1:4]
###################################################
### chunk number 3:
###################################################
df_clean <- df_clean %>%
group_by(ticker) %>%
arrange(time_numeric) %>%
mutate(
data = na.approx(data, na.rm = FALSE)  # linear interpolation
) %>%
ungroup()
dataprep(
foo = df_clean,
predictors = c("assets",  "net_margin_pct"),
dependent = "revenue",
unit.variable = "company_id",          # numeric ID column
unit.names.variable = "ticker",        # readable name
time.variable = "time_numeric",                  # or numeric time index
treatment.identifier = 3,              # treated company ID
controls.identifier = c(1,2), # control company IDs
time.predictors.prior = 2010.25:2023.75,
time.optimize.ssr = 2010.25:2023.75,         # pre-treatment period
time.plot = 2010.25:2025.75                  # full period to plot
)
df_clean %>% tibble(ticker, revenue, time_numeric)
df_clean %>%
select(ticker, revenue, time_numeric)
df_clean %>%
count(ticker) %>%
arrange(desc(n))
df_clean %>%
count(ticker, time_numeric) %>%
arrange(ticker, time_numeric)
df_clean %>%
count(time_numeric) %>%
arrange(time_numeric)
df_clean %>%
count(time_numeric)
df_clean %>%
count(fp)
df_clean %>%
count(fy)
###################################################
### chunk number 3:
###################################################
df_clean <- df_clean %>%
group_by(ticker) %>%
arrange(time_numeric) %>%
mutate(
data = na.approx(data, na.rm = FALSE)  # linear interpolation
) %>%
ungroup()
###################################################
### chunk number 3:
###################################################
df_clean <- df_clean %>%
group_by(ticker) %>%
arrange(time_numeric) %>%
mutate(
revenue = na.approx(revenue, na.rm = FALSE)
) %>%
ungroup()
dataprep(
foo = df_clean,
predictors = c("assets",  "net_margin_pct"),
dependent = "revenue",
unit.variable = "company_id",          # numeric ID column
unit.names.variable = "ticker",        # readable name
time.variable = "time_numeric",                  # or numeric time index
treatment.identifier = 3,              # treated company ID
controls.identifier = c(1,2), # control company IDs
time.predictors.prior = 2010.25:2023.75,
time.optimize.ssr = 2010.25:2023.75,         # pre-treatment period
time.plot = 2010.25:2025.75                  # full period to plot
)
str(df_clean)
dataprep(
foo = df_clean,
predictors = c("assets",  "net_margin_pct"),
dependent = "revenue",
unit.variable = "company_id",          # numeric ID column
unit.names.variable = "ticker",        # readable name
time.variable = "time_numeric",                  # or numeric time index
treatment.identifier = 3,              # treated company ID
controls.identifier = c(1,2), # control company IDs
time.predictors.prior = 2010.25:2023.75,
time.optimize.ssr = 2010.25:2023.75,         # pre-treatment period
time.plot = 2010.25:2025.75                  # full period to plot
)
dataprep(
foo = df_clean,
predictors = c("assets",  "net_margin_pct"),
dependent = "revenue",
unit.variable = company_id,          # numeric ID column
unit.names.variable = "ticker",        # readable name
time.variable = "time_numeric",                  # or numeric time index
treatment.identifier = 3,              # treated company ID
controls.identifier = c(1,2), # control company IDs
time.predictors.prior = 2010.25:2023.75,
time.optimize.ssr = 2010.25:2023.75,         # pre-treatment period
time.plot = 2010.25:2025.75                  # full period to plot
)
dataprep(
foo = df_clean,
predictors = c("assets",  "net_margin_pct"),
dependent = "revenue",
unit.variable = 'company_id',          # numeric ID column
unit.names.variable = "ticker",        # readable name
time.variable = "time_numeric",                  # or numeric time index
treatment.identifier = 3,              # treated company ID
controls.identifier = c(1,2), # control company IDs
time.predictors.prior = 2010.25:2023.75,
time.optimize.ssr = 2010.25:2023.75,         # pre-treatment period
time.plot = 2010.25:2025.75                  # full period to plot
)
type(df_clean$company_id)
class(df_clean$company_id)
table(df_clean$company_id)
sum(is.na(df_clean$company_id))
"company_id" %in% names(df_clean)
is.numeric(df_clean$company_id)
length(unique(df_clean$company_id))
sum(is.na(df_clean$company_id))
###################################################
### chunk number 1:
###################################################
library("Synth")
library(readr)
library('dplyr')
library(skimr)
df <- read_csv("data/merged_dataset_2025-11-01_16-55.csv")
id_cols <- c("boycotted", "ticker", "fp", "end")
# Step 2: preprocessing
df_clean <- df %>%
filter(ticker != "COKE") %>% #make sure there just one target
filter(ticker != "CMG") %>% #    drop for now, must see if script runs when df is balanced
filter(ticker != "WEN") %>% #drop for now, must see if script runs when df is balanced
filter(ticker != "BROS") %>% #drop for now, must see if script runs when df is balanced
filter(fy != "2026") %>%
mutate(company_id = as.numeric(as.factor(ticker))) %>%
group_by(ticker, fy) %>%
# count quarters per company-year
mutate(n_quarters = n_distinct(fp)) %>%
# keep only company-years with at least 3 quarters
filter(n_quarters >= 3) %>%
ungroup() %>%
select(-n_quarters) %>%       # remove helper column
mutate(across(
.cols = -all_of(id_cols),          # all columns except identifiers
.fns  = ~ as.numeric(.))) %>%      # convert to numeric, quietly
ungroup() %>%
mutate(
# Turn fp (Q1, Q2, Q3, Q4) into numeric quarter fraction
quarter_num = case_when(
fp == "Q1" ~ 0.25,
fp == "Q2" ~ 0.50,
fp == "Q3" ~ 0.75,
fp == "Q4" ~ 1.00,
TRUE ~ NA_real_
),
# Combine fiscal year and quarter into one numeric time variable
time_numeric = fy + quarter_num) %>%
as.data.frame()
df_clean <- df_clean %>%
group_by(ticker) %>%
arrange(time_numeric) %>%
mutate(
revenue = na.approx(revenue, na.rm = FALSE)
) %>%
ungroup()
###################################################
### chunk number 2:
###################################################
df_clean[85:89, 1:4]
dataprep(
foo = df_clean,
predictors = c("assets",  "net_margin_pct"),
dependent = "revenue",
unit.variable = 'company_id',          # numeric ID column
unit.names.variable = "ticker",        # readable name
time.variable = "time_numeric",                  # or numeric time index
treatment.identifier = 3,              # treated company ID
controls.identifier = c(1,2), # control company IDs
time.predictors.prior = 2010.25:2023.75,
time.optimize.ssr = 2010.25:2023.75,         # pre-treatment period
time.plot = 2010.25:2025.75                  # full period to plot
)
df_clean %>% filter(c(revenue, time_numeric))
df_clean %>% select(c(revenue, time_numeric))
dataprep(
foo = df_clean,
predictors = c("assets",  "net_margin_pct"),
dependent = drop.na("revenue"),
unit.variable = 'company_id',          # numeric ID column
unit.names.variable = "ticker",        # readable name
time.variable = "time_numeric",                  # or numeric time index
treatment.identifier = 3,              # treated company ID
controls.identifier = c(1,2), # control company IDs
time.predictors.prior = 2010.25:2023.75,
time.optimize.ssr = 2010.25:2023.75,         # pre-treatment period
time.plot = 2010.25:2025.75                  # full period to plot
)
dataprep(
foo = df_clean,
predictors = c("assets",  "net_margin_pct"),
dependent = is.na("revenue"),
unit.variable = 'company_id',          # numeric ID column
unit.names.variable = "ticker",        # readable name
time.variable = "time_numeric",                  # or numeric time index
treatment.identifier = 3,              # treated company ID
controls.identifier = c(1,2), # control company IDs
time.predictors.prior = 2010.25:2023.75,
time.optimize.ssr = 2010.25:2023.75,         # pre-treatment period
time.plot = 2010.25:2025.75                  # full period to plot
)
###################################################
### chunk number 1:
###################################################
library("Synth")
library(readr)
library('dplyr')
library(skimr)
df <- read_csv("data/merged_dataset_2025-11-01_16-55.csv")
id_cols <- c("boycotted", "ticker", "fp", "end")
# Step 2: preprocessing
df_clean <- df %>%
filter(ticker != "COKE") %>% #make sure there just one target
filter(ticker != "CMG") %>% #    drop for now, must see if script runs when df is balanced
filter(ticker != "WEN") %>% #drop for now, must see if script runs when df is balanced
filter(ticker != "BROS") %>% #drop for now, must see if script runs when df is balanced
filter(fy != "2026") %>%
mutate(company_id = as.numeric(as.factor(ticker))) %>%
group_by(ticker, fy) %>%
# count quarters per company-year
mutate(n_quarters = n_distinct(fp)) %>%
# keep only company-years with at least 3 quarters
filter(n_quarters >= 3) %>%
ungroup() %>%
select(-n_quarters) %>%       # remove helper column
mutate(across(
.cols = -all_of(id_cols),          # all columns except identifiers
.fns  = ~ as.numeric(.))) %>%      # convert to numeric, quietly
ungroup() %>%
mutate(
# Turn fp (Q1, Q2, Q3, Q4) into numeric quarter fraction
quarter_num = case_when(
fp == "Q1" ~ 0.25,
fp == "Q2" ~ 0.50,
fp == "Q3" ~ 0.75,
fp == "Q4" ~ 1.00,
TRUE ~ NA_real_
),
# Combine fiscal year and quarter into one numeric time variable
time_numeric = fy + quarter_num) %>%
as.data.frame()
df_clean <- df_clean %>%
group_by(ticker) %>%
arrange(time_numeric) %>%
mutate(
revenue = na.approx(revenue, na.rm = FALSE)
) %>%
ungroup()
'FOR NOW drop nas for the dependent variable'
df_clean <- df_clean %>%
filter(!is.na(revenue))
###################################################
### chunk number 2:
###################################################
df_clean[85:89, 1:4]
dataprep(
foo = df_clean,
predictors = c("assets",  "net_margin_pct"),
dependent = "revenue",
unit.variable = 'company_id',          # numeric ID column
unit.names.variable = "ticker",        # readable name
time.variable = "time_numeric",                  # or numeric time index
treatment.identifier = 3,              # treated company ID
controls.identifier = c(1,2), # control company IDs
time.predictors.prior = 2010.25:2023.75,
time.optimize.ssr = 2010.25:2023.75,         # pre-treatment period
time.plot = 2010.25:2025.75                  # full period to plot
)
View(df_clean)
###################################################
### chunk number 1:
###################################################
library("Synth")
library(readr)
library('dplyr')
library(skimr)
df <- read_csv("data/merged_dataset_2025-11-01_16-55.csv")
id_cols <- c("boycotted", "ticker", "fp", "end")
'FOR NOW drop nas for the dependent variable'
df_clean <- df_clean %>%
filter(!is.na(revenue))
# Step 2: preprocessing
df_clean <- df %>%
filter(ticker != "COKE") %>% #make sure there just one target
filter(ticker != "CMG") %>% #    drop for now, must see if script runs when df is balanced
filter(ticker != "WEN") %>% #drop for now, must see if script runs when df is balanced
filter(ticker != "BROS") %>% #drop for now, must see if script runs when df is balanced
filter(fy != "2026") %>%
mutate(company_id = as.numeric(as.factor(ticker))) %>%
group_by(ticker, fy) %>%
# count quarters per company-year
mutate(n_quarters = n_distinct(fp)) %>%
# keep only company-years with at least 3 quarters
filter(n_quarters >= 3) %>%
ungroup() %>%
select(-n_quarters) %>%       # remove helper column
mutate(across(
.cols = -all_of(id_cols),          # all columns except identifiers
.fns  = ~ as.numeric(.))) %>%      # convert to numeric, quietly
ungroup() %>%
mutate(
# Turn fp (Q1, Q2, Q3, Q4) into numeric quarter fraction
quarter_num = case_when(
fp == "Q1" ~ 0.25,
fp == "Q2" ~ 0.50,
fp == "Q3" ~ 0.75,
fp == "Q4" ~ 1.00,
TRUE ~ NA_real_
),
# Combine fiscal year and quarter into one numeric time variable
time_numeric = fy + quarter_num) %>%
as.data.frame()
df_clean <- df_clean %>%
group_by(ticker) %>%
arrange(time_numeric) %>%
mutate(
revenue = na.approx(revenue, na.rm = FALSE)
) %>%
ungroup()
###################################################
### chunk number 2:
###################################################
df_clean[85:89, 1:4]
dataprep(
foo = df_clean,
predictors = c("assets",  "net_margin_pct"),
dependent = "revenue",
unit.variable = 'company_id',          # numeric ID column
unit.names.variable = "ticker",        # readable name
time.variable = "time_numeric",                  # or numeric time index
treatment.identifier = 3,              # treated company ID
controls.identifier = c(1,2), # control company IDs
time.predictors.prior = 2010.25:2023.75,
time.optimize.ssr = 2010.25:2023.75,         # pre-treatment period
time.plot = 2010.25:2025.75                  # full period to plot
)
###################################################
### chunk number 1:
###################################################
library("Synth")
library(readr)
library('dplyr')
library(skimr)
df <- read_csv("data/merged_dataset_2025-11-01_16-55.csv")
id_cols <- c("boycotted", "ticker", "fp", "end")
# Step 2: preprocessing
df_clean <- df %>%
filter(ticker != "COKE") %>% #make sure there just one target
filter(ticker != "CMG") %>% #    drop for now, must see if script runs when df is balanced
filter(ticker != "WEN") %>% #drop for now, must see if script runs when df is balanced
filter(ticker != "BROS") %>% #drop for now, must see if script runs when df is balanced
filter(fy != "2026") %>%
mutate(company_id = as.numeric(as.factor(ticker))) %>%
group_by(ticker, fy) %>%
# count quarters per company-year
mutate(n_quarters = n_distinct(fp)) %>%
# keep only company-years with at least 3 quarters
filter(n_quarters >= 3) %>%
ungroup() %>%
select(-n_quarters) %>%       # remove helper column
mutate(across(
.cols = -all_of(id_cols),          # all columns except identifiers
.fns  = ~ as.numeric(.))) %>%      # convert to numeric, quietly
ungroup() %>%
mutate(
# Turn fp (Q1, Q2, Q3, Q4) into numeric quarter fraction
quarter_num = case_when(
fp == "Q1" ~ 0.25,
fp == "Q2" ~ 0.50,
fp == "Q3" ~ 0.75,
fp == "Q4" ~ 1.00,
TRUE ~ NA_real_
),
# Combine fiscal year and quarter into one numeric time variable
time_numeric = fy + quarter_num) %>%
as.data.frame()
'FOR NOW drop nas for the dependent variable'
df_clean <- df_clean %>%
filter(!is.na(revenue))
df_clean <- df_clean %>%
group_by(ticker) %>%
arrange(time_numeric) %>%
mutate(
revenue = na.approx(revenue, na.rm = FALSE)
) %>%
ungroup()
###################################################
### chunk number 2:
###################################################
df_clean[85:89, 1:4]
dataprep(
foo = df_clean,
predictors = c("assets",  "net_margin_pct"),
dependent = "revenue",
unit.variable = 'company_id',          # numeric ID column
unit.names.variable = "ticker",        # readable name
time.variable = "time_numeric",                  # or numeric time index
treatment.identifier = 3,              # treated company ID
controls.identifier = c(1,2), # control company IDs
time.predictors.prior = 2010.25:2023.75,
time.optimize.ssr = 2010.25:2023.75,         # pre-treatment period
time.plot = 2010.25:2025.75                  # full period to plot
)
